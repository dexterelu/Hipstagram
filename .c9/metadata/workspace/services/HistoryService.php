{"filter":false,"title":"HistoryService.php","tooltip":"/services/HistoryService.php","undoManager":{"mark":15,"position":15,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":100,"column":0},"action":"insert","lines":["<?php","","class HipstaFeed{","\tpublic $access_token = '43588672.6acf407.51e35be17cf94965a6509ecdd092ea3e';","\tpublic $api_search = 'https://api.instagram.com/v1/media/search';","","\tpublic $city = array(","\t\t\"bucuresti\" => array(","\t\t\t\t\"lat\"=> 44.4268,","\t\t\t\t\"lng\"=> 26.1025","\t\t\t)","\t\t);","\t","\tpublic function HipstaFeed(){","","\t}","","\tprivate function push($data){","\t\techo \"<Hr><pre>\";","\t\tvar_dump($data);","\t\techo \"</pre>\";","\t}","","\tpublic function feed($city,$from,$to){","\t\tif (!isset($this->city[$city]))","\t\t\t return false;","","\t\twhile ($from<$to) {","\t\t\t$data = $this->getFromAPI($city,$to);","","\t\t\t//do something with it","\t\t\t$this->push($data);","\t\t}","\t}","","\tprivate function getFromAPI($city,&$timestamp){","","\t\t$query = array();","\t\t$query['access_token'] \t= $this->access_token;","\t\t$query['lat'] \t\t\t= $this->city[$city]['lat'];","\t\t$query['lng'] \t\t\t= $this->city[$city]['lng'];","","\t\tif($timestamp !== false){","\t\t\t$query['max_timestamp'] = $timestamp;","\t\t} ","","\t\t$query_str = http_build_query($query);","","\t\t$raw = file_get_contents($this->api_search.\"?\".$query_str);","\t\t$data = json_decode($raw);","","\t\t$this->discard($data,$timestamp);","\t\treturn $this->prepare($data);","\t}","","\tprivate function discard(&$feed,&$timestamp){","\t\t$i = 0;","\t\twhile (is_array($feed->data) && $i<count($feed->data)){","","\t\t\t//update timestamp","\t\t\tif ($feed->data[$i]->created_time < $timestamp || $timestamp === false){","\t\t\t\t$timestamp = $feed->data[$i]->created_time;","\t\t\t}","","\t\t\t//discard filtered & videos","\t\t\tif ($feed->data[$i]->filter == \"Normal\" && $feed->data[$i]->type == \"image\"){","\t\t\t\t$i++;","\t\t\t} else {","\t\t\t\tarray_splice($feed->data,$i,1);","\t\t\t}","","\t\t}","\t}","","\tprivate function prepare(&$feed){","\t\t$data = array();","","\t\tforeach ($feed->data as $media){","\t\t\t$data[] = array(","\t\t\t\t\t'likes' => $media->likes->count,","\t\t\t\t\t'media_url' => $media->images->standard_resolution->url,","\t\t\t);","\t\t}","\t\treturn $data; ","\t}","","","","}","","$hf = new HipstaFeed();","\t","$yesterday = time() - (1 * 24 * 60 * 60); ","$today_3_hours_ago = time() - (3 *60*60);","$today = time(); ","","","$hf->feed('bucuresti',$today_3_hours_ago,$today);","","",""]}]}],[{"group":"doc","deltas":[{"start":{"row":98,"column":0},"end":{"row":98,"column":2},"action":"insert","lines":["*/"]},{"start":{"row":91,"column":0},"end":{"row":91,"column":2},"action":"insert","lines":["/*"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":23},"end":{"row":91,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":92,"column":0},"end":{"row":93,"column":0},"action":"remove","lines":["/*\t",""]}]}],[{"group":"doc","deltas":[{"start":{"row":89,"column":0},"end":{"row":90,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":0},"end":{"row":90,"column":1},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"insert","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"remove","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":0},"end":{"row":90,"column":1},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":0},"end":{"row":90,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"insert","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":2},"end":{"row":90,"column":3},"action":"insert","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":2},"end":{"row":90,"column":3},"action":"remove","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"remove","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"insert","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":6},"end":{"row":2,"column":16},"action":"remove","lines":["HipstaFeed"]},{"start":{"row":2,"column":6},"end":{"row":2,"column":20},"action":"insert","lines":["HistoryService"]},{"start":{"row":13,"column":17},"end":{"row":13,"column":27},"action":"remove","lines":["HipstaFeed"]},{"start":{"row":13,"column":17},"end":{"row":13,"column":31},"action":"insert","lines":["HistoryService"]},{"start":{"row":91,"column":10},"end":{"row":91,"column":20},"action":"remove","lines":["HipstaFeed"]},{"start":{"row":91,"column":10},"end":{"row":91,"column":24},"action":"insert","lines":["HistoryService"]}]}]]},"ace":{"folds":[],"scrolltop":1080,"scrollleft":0,"selection":{"start":{"row":98,"column":0},"end":{"row":99,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1427548049628,"hash":"d69794986b99f7195e364f75e905b7b53cce7708"}